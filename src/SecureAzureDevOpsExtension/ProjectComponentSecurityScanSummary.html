<!DOCTYPE html>
<html>

<head>
  <script src="lib/VSS.SDK.min.js"></script>
  <link href="Styles/bootstrap.min.css" rel="stylesheet">
  </link>
  <script src="scripts/jquery-3.4.1.min.js"></script>
  <script src="scripts/bootstrap.min.js"></script>


  <style>
    .btn-circle {
      width: 12px;
      height: 12px;
      line-height: 12px;
      text-align: center;
      padding: 0;
      border-radius: 50%;
    }

    .btn-circle i {
      position: relative;
      top: -1px;
    }

    .btn-circle-sm {
      width: 8px;
      height: 8px;
    }

    .boxcss {
      width: 130px;
      height: 140px;
      background-color: #ffa726;
      text-align: left;
      padding-top: 2px;
      padding-left: 8px;
      padding-right: 4px;
      margin-right: 5px;
      margin-bottom: 5px;
    }

    .text-primary {
      color: #305f92 !important;
    }

    .bubble-manual {
      background-color: #6c757d;
    }

    .bubble-passed {
      background-color: #339947;
    }

    .bubble-failed {
      background-color: #FF0000;
    }

    .bubble-verify {
      background-color: #FFFF00;
    }
    .bubble-exception {
      background-color: #F58B1F;  
    }
  </style>


  <script type="text/javascript">
 
    // var context = VSS.getWebContext();

    VSS.init({
      explicitNotifyLoaded: true,
      usePlatformStyles: true
    });

    try {
      VSS.ready(() => {
        context = VSS.getWebContext();
        VSS.getService(VSS.ServiceIds.ExtensionData).then(function (dataService) {
          // Get all document under the collection                 
          dataService.getDocuments("MyCollection").then(function (docs) {
            var sel = document.getElementById('resultVersion');
            var datelist= [];
            var formatdatelist = [];
            var dateindex = 0; 
            for (var i = 0; i < docs.length; i++) {
              if (docs[i].id.indexOf(context.project.name) !== -1) {
                var opt = document.createElement('option');
                opt.innerHTML = docs[i].id;
                opt.value = docs[i].id;
                sel.appendChild(opt);
               debugger;
								try {
                //datelist.push(docs[i].id.split("BuildId")[1].split('_')[2]);
                if(docs[i].id.includes("BuildId")){
								    datelist.push(docs[i].id.split("BuildId")[1].split('_')[2]);
								}
								else{
									datelist.push(docs[i].id.split("ReleaseId")[1].split('_')[2]);
								}

								var date = datelist[dateindex].split('-')
                formatdatelist.push( (date[2]+"-"+date[1]+"-"+date[0] + " " + date[3]+":"+date[4]+":"+date[5]))
								dateindex = dateindex + 1;

								} catch (error) {
									
								}
              }
            }
             //datelist.sort(); 
             formatdatelist.sort(sortFunction);
						 //var lastresultdate = datelist[datelist.length -1];
             var lastdates = formatdatelist[formatdatelist.length-1].split(" ");
						 var lastresultdate = (lastdates[0].split("-")[2]+"-"+lastdates[0].split("-")[1]+"-"+lastdates[0].split("-")[0])+"-"+lastdates[1].replace(":","-").replace(":","-");
                        
             var lastresult ='';
						 for (var i = 0; i < docs.length; i++) {
                  if (docs[i].id.indexOf(lastresultdate) != -1) {
						     	lastresult = docs[i]
                 }
						 }
	
						 $("#resultVersion").val(lastresult.id);
						 bindTables(lastresult.value);
						 lastresult = null;
						 docs = null;
          });
        });
      });
    }
    catch (ex) { }

    VSS.require("TFS/Dashboards/WidgetHelpers", function (WidgetHelpers) {
      WidgetHelpers.IncludeWidgetStyles();
      VSS.register("ProjectComponentSecurityScanSummary", function () {
        return {
          load: function (widgetSettings) {
            return WidgetHelpers.WidgetStatusHelper.Success();
          }
        }
      });
      VSS.notifyLoadSucceeded();
    });

    function sortFunction(a,b){  
                 var dateA = new Date(a)
                 var dateB = new Date(b)
                 return dateA > dateB ? 1 : -1;  
        };

    function delay(ms) { // takes amount of milliseconds
      //Arv: returns a new promise
      return new Promise(function (resolve, reject) {
        setTimeout(function () { // when the time is up
          resolve(); // change the promise to the fulfilled state
        }, ms);
      });
    }

    function getDataForChart(resultId) {
      // we're RETURNING the promise, remember, a promise is a wrapper over our value
      return delay(1).then(function () { // when the promise is ready	context.project.name
        return VSS.getService(VSS.ServiceIds.ExtensionData).then(function (dataService) {
          return dataService.getDocument("MyCollection", resultId).then(function (doc) {
            return doc.value;
          });
        });
      });
    }

    function bindData() {
      debugger;
      var versionId = document.getElementById('resultVersion').value;
      if (versionId != null && versionId != "") {
        try {
          document.getElementById('dvScanResult').style.display = "block";
          //bind table with new data
          getDataForChart(versionId).then(function (chartdata) {
            bindTables(chartdata);
          });
        }
        catch (ex) {
          console.log(ex)
        }
      }
    }

    function bindTables(chartdata) {
      document.getElementById('dvScanResult').style.display = "block";
      $("#tblScanResultConnection > tbody").html("");
      $("#tblScanResultBuild > tbody").html("");
      $("#tblScanResultRelease > tbody").html("");
      $("#tblScanResultAgentPool > tbody").html("");
      
      var arrdata = { Passed: 0, Failed: 0, Verify: 0, Exception: 0 };
      var Releasedata = { Passed: 0, Failed: 0, Verify: 0, Exception: 0 };
      var Conndata = { Passed: 0, Failed: 0, Verify: 0, Exception: 0 };
      var AgentPooldata = { Passed: 0, Failed: 0, Verify: 0, Exception: 0 };

      Buildcounter = 0;
      Releasecounter = 0;
      Connectioncounter = 0;
      AgentPoolcounter = 0;

      // Service Connection 
      AzureDevOps_ServiceConnection_AuthN_Use_Cert_Auth_for_SPN = 0;
      AzureDevOps_ServiceConnection_AuthZ_RG_Level = 0;
      AzureDevOps_ServiceConnection_AuthZ_Dont_Use_Classic_Connections = 0;
      AzureDevOps_ServiceConnection_AuthZ_Disable_InheritPermissions = 0;

      // Build:
      AzureDevOps_Build_AuthZ_Disable_Inherited_Permissions = 0;
      AzureDevOps_Build_SI_Review_Inactive_Build = 0;

      // Release:
      AzureDevOps_Release_SI_Review_Inactive_Release = 0;
      AzureDevOps_Release_AuthZ_Disable_Inherited_Permissions = 0;
      AzureDevOps_Release_AuthZ_Enable_PreDeployment_Approvals = 0;

      //AgentPool
      AzureDevOps_AgentPool_AuthZ_Project_Dont_Grant_All_Pipeline_Access = 0;

       const build = chartdata.filter(function (name) {
         return name.FeatureName == 'Build';
       }).map(x => x.ResourceName);
       Buildcounter = build.unique().length;

       const locrelease = chartdata.filter(function (name) {
         return name.FeatureName == 'Release';
       }).map(x => x.ResourceName);
       Releasecounter = locrelease.unique().length;

       const locconnections = chartdata.filter(function (name) {
         return name.FeatureName == 'ServiceConnection';
       }).map(x => x.ResourceId);
       Connectioncounter = locconnections.unique().length;

       const locagentpool = chartdata.filter(function (name) {
         return name.FeatureName == 'AgentPool';
       }).map(x => x.ResourceId);
       AgentPoolcounter = locagentpool.unique().length;

      chartdata.forEach(function (e) {
        var bulbClass = 'bubble-manual';

        if (e.FeatureName == "ServiceConnection") {
          if (e.Status == "Passed") {
            Conndata.Passed = Conndata.Passed + 1;
            bulbClass = 'bubble-passed';
          }
          else if (e.Status == "Verify") {
            Conndata.Verify = Conndata.Verify + 1;
            bulbClass = 'bubble-verify';
          }
          else if (e.Status == "Exception") {
            Conndata.Exception = Conndata.Exception + 1;
            bulbClass = 'bubble-exception';
          }
          else if (e.Status == "Failed") {
            Conndata.Failed = Conndata.Failed + 1;
            bulbClass = 'bubble-failed';

            if (e.ControlID == "AzureDevOps_ServiceConnection_AuthN_Use_Cert_Auth_for_SPN") {
              AzureDevOps_ServiceConnection_AuthN_Use_Cert_Auth_for_SPN = AzureDevOps_ServiceConnection_AuthN_Use_Cert_Auth_for_SPN + 1;
            }
            if (e.ControlID == "AzureDevOps_ServiceConnection_AuthZ_RG_Level") {
              AzureDevOps_ServiceConnection_AuthZ_RG_Level = AzureDevOps_ServiceConnection_AuthZ_RG_Level + 1;
            }
            if (e.ControlID == "AzureDevOps_ServiceConnection_AuthZ_Dont_Use_Classic_Connections") {
              AzureDevOps_ServiceConnection_AuthZ_Dont_Use_Classic_Connections = AzureDevOps_ServiceConnection_AuthZ_Dont_Use_Classic_Connections + 1;
            }
            if (e.ControlID == "AzureDevOps_ServiceConnection_AuthZ_Disable_InheritPermissions") {
              AzureDevOps_ServiceConnection_AuthZ_Disable_InheritPermissions = AzureDevOps_ServiceConnection_AuthZ_Disable_InheritPermissions + 1;
            }
          }
         
          $('#tblScanResultConnection').find('tbody')
            .append('<tr>').append('<td width="40%" ><span class="text-primary">' + e.Description + '</span></td>')
            .append('<td width="20%" >' + e.ControlSeverity + '</td>')
            .append('<td width="20%" >' + e.ResourceName + '</td>')
            .append('<td width="20%" > <span class="btn ' + bulbClass + ' btn-circle btn-circle-sm"></span>&nbsp;' + e.Status + '</td>')
            .append('<td width="20%" > <a href=' + e.ResourceLink + ' target="_blank">Click to find resource</a></td>')
            .append('</tr>');
              
        }

        else if (e.FeatureName == "Build") {
          if (e.Status == "Passed") {
            arrdata.Passed = arrdata.Passed + 1;
            bulbClass = 'bubble-passed';
          }
          else if (e.Status == "Verify") {
            arrdata.Verify = arrdata.Verify + 1;
            bulbClass = 'bubble-verify';
          }
          else if (e.Status == "Exception") {
            arrdata.Exception = arrdata.Exception + 1;
            bulbClass = 'bubble-exception';
          }
          else if (e.Status == "Failed") {
            arrdata.Failed = arrdata.Failed + 1;
            bulbClass = 'bubble-failed';
            if (e.ControlID == "AzureDevOps_Build_AuthZ_Disable_Inherited_Permissions") {
              AzureDevOps_Build_AuthZ_Disable_Inherited_Permissions = AzureDevOps_Build_AuthZ_Disable_Inherited_Permissions + 1;
            }
            if (e.ControlID == "AzureDevOps_Build_SI_Review_Inactive_Build") {
              AzureDevOps_Build_SI_Review_Inactive_Build = AzureDevOps_Build_SI_Review_Inactive_Build + 1;
            }
          }

          $('#tblScanResultBuild').find('tbody')
            .append('<tr>').append('<td width="40%" ><span class="text-primary">' + e.Description + '</span></td>')
            .append('<td width="20%" >' + e.ControlSeverity + '</td>')
            .append('<td width="20%" >' + e.ResourceName + '</td>')
            .append('<td width="20%" > <span class="btn ' + bulbClass + ' btn-circle btn-circle-sm"></span>&nbsp;' + e.Status + '</td>')
            .append('<td width="20%" > <a href=' + e.ResourceLink + ' target="_blank">Click to find resource</a></td>')
            .append('</tr>');

        }

        else if (e.FeatureName == "Release") {
          if (e.Status == "Passed") {
            Releasedata.Passed = Releasedata.Passed + 1;
            bulbClass = 'bubble-passed';
          }
         else if (e.Status == "Verify") {
            Releasedata.Verify = Releasedata.Verify + 1;
            bulbClass = 'bubble-verify';
          }
          else if (e.Status == "Exception") {
            Releasedata.Exception = Releasedata.Exception + 1;
            bulbClass = 'bubble-exception';
          }
         else if (e.Status == "Failed") {
            Releasedata.Failed = Releasedata.Failed + 1;
            bulbClass = 'bubble-failed';

            if (e.ControlID == "AzureDevOps_Release_SI_Review_Inactive_Release") {
              AzureDevOps_Release_SI_Review_Inactive_Release = AzureDevOps_Release_SI_Review_Inactive_Release + 1;
            }
            if (e.ControlID == "AzureDevOps_Release_AuthZ_Disable_Inherited_Permissions") {
              AzureDevOps_Release_AuthZ_Disable_Inherited_Permissions = AzureDevOps_Release_AuthZ_Disable_Inherited_Permissions + 1;
            }
            if (e.ControlID == "AzureDevOps_Release_AuthZ_Enable_PreDeployment_Approvals") {
              AzureDevOps_Release_AuthZ_Enable_PreDeployment_Approvals = AzureDevOps_Release_AuthZ_Enable_PreDeployment_Approvals + 1;
            }
          }
          
          $('#tblScanResultRelease').find('tbody')
            .append('<tr>').append('<td width="40%" ><span class="text-primary">' + e.Description + '</span></td>')
            .append('<td width="20%" >' + e.ControlSeverity + '</td>')
            .append('<td width="20%" >' + e.ResourceName + '</td>')
            .append('<td width="20%" > <span class="btn ' + bulbClass + ' btn-circle btn-circle-sm"></span>&nbsp;' + e.Status + '</td>')
            .append('<td width="20%" > <a href=' + e.ResourceLink + ' target="_blank">Click to find resource</a></td>')
            .append('</tr>');
        } 
        else if (e.FeatureName == "AgentPool") {
          if (e.Status == "Passed") {
            AgentPooldata.Passed = AgentPooldata.Passed + 1;
            bulbClass = 'bubble-passed';
          }
         else if (e.Status == "Verify") {
            AgentPooldata.Verify = AgentPooldata.Verify + 1;
            bulbClass = 'bubble-verify';
          }
          else if (e.Status == "Exception") {
            AgentPooldata.Exception = AgentPooldata.Exception + 1;
            bulbClass = 'bubble-exception';
          }
         else if (e.Status == "Failed") {
            AgentPooldata.Failed = AgentPooldata.Failed + 1;
            bulbClass = 'bubble-failed';
            if (e.ControlID == "AzureDevOps_AgentPool_AuthZ_Project_Dont_Grant_All_Pipeline_Access") {
            AzureDevOps_AgentPool_AuthZ_Project_Dont_Grant_All_Pipeline_Access = AzureDevOps_AgentPool_AuthZ_Project_Dont_Grant_All_Pipeline_Access + 1;
            }
          }
          $('#tblScanResultAgentPool').find('tbody')
            .append('<tr>').append('<td width="40%" ><span class="text-primary">' + e.Description + '</span></td>')
            .append('<td width="20%" >' + e.ControlSeverity + '</td>')
            .append('<td width="20%" >' + e.ResourceName + '</td>')
            .append('<td width="20%" > <span class="btn ' + bulbClass + ' btn-circle btn-circle-sm"></span>&nbsp;' + e.Status + '</td>')
            .append('<td width="20%" > <a href=' + e.ResourceLink + ' target="_blank">Click to find resource</a></td>')
            .append('</tr>');
        }

      });

      document.getElementById("BuildWidget").innerHTML = Buildcounter;
      document.getElementById("ReleaseWidget").innerHTML = Releasecounter;
      document.getElementById("ConnectionWidget").innerHTML = Connectioncounter;
      document.getElementById("AgentPoolWidget").innerHTML = AgentPoolcounter;

      try {
        //Connections
        document.getElementById("AzureDevOps_ServiceConnection_AuthN_Use_Cert_Auth_for_SPN").innerHTML = AzureDevOps_ServiceConnection_AuthN_Use_Cert_Auth_for_SPN;
        document.getElementById("AzureDevOps_ServiceConnection_AuthZ_RG_Level").innerHTML = AzureDevOps_ServiceConnection_AuthZ_RG_Level;
        document.getElementById("AzureDevOps_ServiceConnection_AuthZ_Dont_Use_Classic_Connections").innerHTML = AzureDevOps_ServiceConnection_AuthZ_Dont_Use_Classic_Connections;
        document.getElementById("AzureDevOps_ServiceConnection_AuthZ_Disable_InheritPermissions").innerHTML = AzureDevOps_ServiceConnection_AuthZ_Disable_InheritPermissions;

        // build
        document.getElementById("AzureDevOps_Build_AuthZ_Disable_Inherited_Permissions").innerHTML = AzureDevOps_Build_AuthZ_Disable_Inherited_Permissions;
        document.getElementById("AzureDevOps_Build_SI_Review_Inactive_Build").innerHTML = AzureDevOps_Build_SI_Review_Inactive_Build;

        // release
        document.getElementById("AzureDevOps_Release_SI_Review_Inactive_Release").innerHTML = AzureDevOps_Release_SI_Review_Inactive_Release;
        document.getElementById("AzureDevOps_Release_AuthZ_Disable_Inherited_Permissions").innerHTML = AzureDevOps_Release_AuthZ_Disable_Inherited_Permissions;
        document.getElementById("AzureDevOps_Release_AuthZ_Enable_PreDeployment_Approvals").innerHTML = AzureDevOps_Release_AuthZ_Enable_PreDeployment_Approvals;

        //Agent Pool
        document.getElementById("AzureDevOps_AgentPool_AuthZ_Project_Dont_Grant_All_Pipeline_Access").innerHTML = AzureDevOps_AgentPool_AuthZ_Project_Dont_Grant_All_Pipeline_Access;
      }
      catch (ex) { console.log(ex); }

      createChart('Chart-ContainerConnection', Conndata, 'Connection Scan Result');
      createChart('Chart-ContainerBuild', arrdata, 'Build Scan Result');
      createChart('Chart-ContainerRelease', Releasedata, 'Release Scan Result');
      createChart('Chart-ContainerAgentPool', AgentPooldata, 'AgentPool Scan Result');
    }

    //Create chart
    function createChart(container, dataforchart, charttitle) {
      Highcharts.chart(container, {
        title: {
          text: charttitle
        },
        chart: {
          type: 'pie'
        },
        credits: {
          enabled: false
        },
        plotOptions: {
          pie: {
            dataLabels: {
              enabled: true,
              format: '<b>{point.name}</b><br>Count: {point.y}',
            }
          }
        },
        xAxis: {
          categories: ['Passed', 'Failed', 'Verify','Exception']
        },
        legend: {
          layout: 'horizontal',
          verticalAlign: 'bottom',
          labelFormat: '{name} ({y})'
        },
        series: [{
          name: 'Control',
          data: [{ name: 'Passed', y: dataforchart.Passed, color: '#339947' }, { name: 'Failed', y: dataforchart.Failed, color: '#FF0000' }, { name: 'Verify', y: dataforchart.Verify, color: '#FFFF00' }, { name: 'Exception', y: dataforchart.Exception, color: '#F58B1F' }],
          innerSize: '45%',
          showInLegend: true
        }]
      });
    }

    Array.prototype.unique = function () {
      return this.filter(function (value, index, self) {
        return self.indexOf(value) === index;
      });
    };

    //open model bind data
    function openModel(ControlID, scanType) {
    try {

      $('#spnFailedControl').html(ControlID);
      var versionId = document.getElementById('resultVersion').value;
      getDataForChart(versionId).then(function (chartdata) {
        //ControlID ="AzureDevOps_Build_DP_No_PlainText_Secrets_In_Definition"; scanType ="Build";
        var locdata = chartdata.filter(function (data) {
          return (data.ControlID == ControlID && data.FeatureName == scanType && data.Status == "Failed");
        });
        $('#tblControlFailDetails tbody').empty();
        locdata.forEach(function (e) {
          $('#tblControlFailDetails').find('tbody')
            .append('<tr>').append('<td width="30%" ><span class="text-primary">' + e.ResourceGroupName + '</span></td>')
            .append('<td width="30%" >' + e.ResourceName + '</td>')
            .append('<td width="30%">-</td>')
            .append('</tr>');
        });
      });
    }
    catch (ex) { console.log(ex); }
  }

  </script>
</head>

<body style="width: 100%; height: 100%;">
  <div class="widget">
    <!--  style="overflow-y: scroll; overflow-x: hidden;" -->
    <div class="row">
      <div class="col-sm-11">
        <div class="card" align="left" style="align-items: left;">
          <div class="card-header" style="text-align: left;">
            <strong>
              <h2>ADO Security Scanner: Scan Summary for Build/Release/Connections/AgentPools. </h2>
            </strong>
            <a href="http://aka.ms/devopskit/ADOSecurity">ADO Security Scanner </a>
          </div>
          <div class="card-body">
            <!--   <button type="button" onclick="openModel()" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">Open Modal</button> -->
            The ADO Security Scanner toolkit helps with secure configuration of your organization/project/build/release artifacts in ADO. You can run this toolkit using PowerShell on your local machine or as an extension task in an ADO pipeline.
            <div class="row">
              <div class="col-sm-2">Select Version : </div>
              <div class="col-sm-6">
                <select id="resultVersion" class="form-control" onchange="bindData()" width="300px">
                  <option value="" width="300px">Select</option>
                </select>
              </div>
            </div>

          </div>
        </div><!-- /# card -->
      </div>
    </div>

    <div id="dvScanResult" style="display: none;">
    <!--  Service Connection -->
    <div class="row border" style="margin-top: 0.4em; padding: 0.4em;">

      <div class="col-sm-1" style="max-height: 150px; margin-top: 0.2em">
        <div style='border-bottom:3px solid #90caf9;'></div>
        <span class="text-primary" id="linkBuildHub3">
          <h2 class="title">Total <br>Connections</h2>
          <div class="big-count" id="ConnectionWidget" id="DisplayCount">-</div>
        </span>
        <div style='border-bottom:3px solid #90caf9;'>Security status for service connections used in pipelines</div>
      </div>
      <div class="col-sm-3">
        <!--/.col-->
        <div class="card">
          <div class="card-body">
            <div id="Chart-ContainerConnection" style="margin: 0 auto; height:300px;"></div>
          </div>
        </div>
      </div>

      <div class="col-sm-2">
        <div class="row">
          <!-- <div class="card text-white" style="max-width:110px; max-height:120px;background-color:#ff4444">
                            <div class="card-body">
                              <span class="card-title">Cert Auth for SPN</span>
                              <p class="card-text" id="AzureDevOps_ServiceConnection_AuthN_Use_Cert_Auth_for_SPN">0 </p>
                            </div>
                          </div> -->
          <div class="boxcss"
            onclick="openModel('AzureDevOps_ServiceConnection_AuthN_Use_Cert_Auth_for_SPN', 'ServiceConnection')"
            data-toggle="modal" data-target="#myModal">
            <font size="2">SPN with secret &nbsp;&nbsp;</font><br><br>
            <font size="12"> <span style="margin-top:-5px; cursor:pointer" class="text-primary"
                id="AzureDevOps_ServiceConnection_AuthN_Use_Cert_Auth_for_SPN">- </span> </font>
          </div>

          <!-- <div class="card text-white" style="max-width:110px; max-height:120px;background-color:#ff4444">
                            <div class="card-body">
                              <span class="card-title">AuthZ RG Level</span>
                              <div class="card-text" id="AzureDevOps_ServiceConnection_AuthZ_RG_Level">0</div>
                            </div>
                          </div> -->
          <div class="boxcss" onclick="openModel('AzureDevOps_ServiceConnection_AuthZ_RG_Level', 'ServiceConnection')"
            data-toggle="modal" data-target="#myModal">
            <font size="2">SPN with sub level access</font><br>
            <font size="12"> <span style="cursor:pointer" class="text-primary"
                id="AzureDevOps_ServiceConnection_AuthZ_RG_Level">- </span> </font>
          </div>

          <!-- <div class="card text-white" style="max-width:110px; max-height:120px;background-color:#ff4444">
                            <div class="card-body">
                              <span class="card-title">Use Classic Conn</span>
                              <p class="card-text" id="AzureDevOps_ServiceConnection_AuthZ_Dont_Use_Classic_Connections">0 </p>
                            </div>
                          </div> -->
          <div class="boxcss"
            onclick="openModel('AzureDevOps_ServiceConnection_AuthZ_Dont_Use_Classic_Connections', 'ServiceConnection')"
            data-toggle="modal" data-target="#myModal">
            <font size="2">Azure Classic Connections</font><br>
            <font size="12"> <span style="cursor:pointer" class="text-primary"
                id="AzureDevOps_ServiceConnection_AuthZ_Dont_Use_Classic_Connections">- </span></font>
          </div>

          <!-- <div class="card text-white" style="max-width:110px; max-height:120px;background-color:#ff4444">
                            <div class="card-body">
                              <span class="card-title">Disable InheritPerm</span>
                              <p class="card-text" id="AzureDevOps_ServiceConnection_AuthZ_Disable_InheritPermissions">0 </p>
                            </div>
                          </div> -->
          <div class="boxcss"
            onclick="openModel('AzureDevOps_ServiceConnection_AuthZ_Disable_InheritPermissions', 'ServiceConnection')"
            data-toggle="modal" data-target="#myModal">
            <font size="2">Inheritted Permis. allowed</font><br>
            <font size="12"> <span style="cursor:pointer" class="text-primary"
                id="AzureDevOps_ServiceConnection_AuthZ_Disable_InheritPermissions">- </span> </font>
          </div>

        </div>
      </div>

      <div class="col-sm-5" style="overflow:scroll;height:320px;width:100%;overflow:auto">
        <div class="media-body">
          <h2 class="text-blue">Scan Report</h2>
          <table id="tblScanResultConnection" class="table table-borderless table-sm">
            <thead style="border-bottom:solid; border-width: 1px;">
              <tr>
                <th width="30%">Description</th>
                <th width="20%">Severity</th>
                <th width="20%">Resource Name</th>
                <th width="20%">Status</th>
                <th width="10%">Resource</th>
              </tr>
            </thead>
            <tbody class="table table-borderless">
            </tbody>
          </table>
        </div>



      </div>
    </div>

    <!--  Build -->
    <div class="row border" style="margin-top: 0.4em; padding: 0.4em;">
      <div class="col-sm-1" style="max-height: 150px;margin-top: 0.2em">
        <div style='border-bottom:3px solid #90caf9;'></div>
        <span class="text-primary" id="linkBuildHub">
          <h2 class="title">Total <br> Builds</h2>
          <div class="big-count" id="BuildWidget" id="DisplayCount">-</div>
        </span>
        <div style='border-bottom:3px solid #90caf9;'>Security status for build used in pipelines</div>
      </div>
      <div class="col-sm-3">
        <!--/.col-->
        <div class="card">
          <div class="card-body">
            <div id="Chart-ContainerBuild" style="margin: 0 auto; height:300px;"></div>
          </div>
        </div>
      </div>

      <div class="col-sm-2">
        <div class="row">

          <!-- <div class="card text-white" style="max-width:110px; max-height:120px;background-color:#ff4444">
                                     <div class="card-body">
                                       <span class="card-title">Disable InheritPerm</span>
                                       <p class="card-text" id="AzureDevOps_Build_AuthZ_Disable_Inherited_Permissions">0 </p>
                                     </div>
                                   </div> -->
          <div class="boxcss" onclick="openModel('AzureDevOps_Build_AuthZ_Disable_Inherited_Permissions', 'Build')"
            data-toggle="modal" data-target="#myModal">
            <font size="2">Inheritted Permis. allowed </font><br>
            <font size="12"> <span style="cursor:pointer" class="text-primary"
                id="AzureDevOps_Build_AuthZ_Disable_Inherited_Permissions">- </span> </font>
          </div>

          <!-- <div class="card text-white" style="max-width:110px; max-height:120px;background-color:#ff4444">
                                     <div class="card-body">
                                       <span class="card-title">InActive Build</span>
                                       <div class="card-text" id="AzureDevOps_Build_SI_Review_Inactive_Build">0</div>
                                     </div>
                                   </div> -->
          <div class="boxcss" onclick="openModel('AzureDevOps_Build_SI_Review_Inactive_Build', 'Build')"
            data-toggle="modal" data-target="#myModal">
            <font size="2">InActive Build &nbsp;&nbsp; &nbsp;&nbsp;</font><br><br>
            <font size="12"> <span style="cursor:pointer" class="text-primary"
                id="AzureDevOps_Build_SI_Review_Inactive_Build">- </span> </font>
          </div>

        </div>
      </div>

      <div class="col-sm-5" style="overflow:scroll;height:320px;width:100%;overflow:auto">
        <div class="media-body">
          <h2 class="text-blue">Scan Report</h2>
          <table id="tblScanResultBuild" class="table table-borderless table-sm">
            <thead style="border-bottom:solid; border-width: 1px;">
              <tr>
                <th width="30%">Description</th>
                <th width="20%">Severity</th>
                <th width="20%">Resource Name</th>
                <th width="20%">Status</th>
                <th width="10%">Resource</th>
              </tr>
            </thead>
            <tbody class="table table-borderless">
            </tbody>
          </table>
        </div>



      </div>
    </div>

    <!--  Release -->
    <div class="row border" style="margin-top: 0.4em; padding: 0.4em;">
      <div class="col-sm-1" style="max-height: 150px;margin-top: 0.2em">
        <div style='border-bottom:3px solid #90caf9;'></div>
        <span class="text-primary" id="linkBuildHub2">
          <h2 class="title">Total <br> Release</h2>
          <div class="big-count" id="ReleaseWidget" id="DisplayCount">-</div>
        </span>
        <div style='border-bottom:3px solid #90caf9;'>Security status for release used in pipelines</div>
      </div>
      <div class="col-sm-3">
        <!--/.col-->
        <div class="card">
          <div class="card-body">
            <div id="Chart-ContainerRelease" style="margin: 0 auto; height:300px;"></div>
          </div>
        </div>
      </div>

      <div class="col-sm-2">
        <div class="row">

          <div class="boxcss" onclick="openModel('AzureDevOps_Release_SI_Review_Inactive_Release', 'Release')"
            data-toggle="modal" data-target="#myModal">
            <font size="2">InActive Release &nbsp;&nbsp;</font><br><br>
            <font size="12"> <span style="cursor:pointer" class="text-primary"
                id="AzureDevOps_Release_SI_Review_Inactive_Release">- </span> </font>
          </div>

          <div class="boxcss" onclick="openModel('AzureDevOps_Release_AuthZ_Disable_Inherited_Permissions', 'Release')"
            data-toggle="modal" data-target="#myModal">
            <font size="2">Inheritted Permis. allowed </font><br>
            <font size="12"> <span style="cursor:pointer" class="text-primary"
                id="AzureDevOps_Release_AuthZ_Disable_Inherited_Permissions">- </span> </font>
          </div>

          <div class="boxcss" onclick="openModel('AzureDevOps_Release_AuthZ_Enable_PreDeployment_Approvals', 'Release')"
            data-toggle="modal" data-target="#myModal">
            <font size="2">Pre Depl App Req </font><br><br>
            <font size="12"> <span style="cursor:pointer" class="text-primary"
                id="AzureDevOps_Release_AuthZ_Enable_PreDeployment_Approvals">- </span> </font>
          </div>

        </div>
      </div>

      <div class="col-sm-5" style="overflow:scroll;height:320px;width:100%;overflow:auto">
        <div class="media-body">
          <h2 class="text-blue">Scan Report</h2>
          <table id="tblScanResultRelease" class="table table-borderless table-sm">
            <thead style="border-bottom:solid; border-width: 1px;">
              <tr>
                <th width="30%">Description</th>
                <th width="20%">Severity</th>
                <th width="20%">Resource Name</th>
                <th width="20%">Status</th>
                <th width="10%">Resource</th>
              </tr>
            </thead class="table table-borderless">
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!--  AgentPool -->
    <div class="row border" style="margin-top: 0.4em; padding: 0.4em;">
      <div class="col-sm-1" style="max-height: 150px;margin-top: 0.2em">
        <div style='border-bottom:3px solid #90caf9;'></div>
        <span class="text-primary" id="linkAgentPoolHub">
          <h2 class="title">Total <br> AgentPool</h2>
          <div class="big-count" id="AgentPoolWidget" id="DisplayCount">-</div>
        </span>
        <div style='border-bottom:3px solid #90caf9;'>Security status for agent pool used in pipelines</div>
      </div>
      <div class="col-sm-3">
        <!--/.col-->
        <div class="card">
          <div class="card-body">
            <div id="Chart-ContainerAgentPool" style="margin: 0 auto; height:300px;"></div>
          </div>
        </div>
      </div>

      <div class="col-sm-2">
        <div class="row">
          <div class="boxcss" onclick="openModel('AzureDevOps_AgentPool_AuthZ_Project_Dont_Grant_All_Pipeline_Access', 'AgentPool')"
            data-toggle="modal" data-target="#myModal">
            <font size="2">Don't Grant All PipeLine Access </font><br><br>
            <font size="12"> <span style="cursor:pointer" class="text-primary"
                id="AzureDevOps_AgentPool_AuthZ_Project_Dont_Grant_All_Pipeline_Access">- </span> </font>
          </div>

        </div>
      </div>

      <div class="col-sm-5" style="overflow:scroll;height:320px;width:100%;overflow:auto">
        <div class="media-body">
          <h2 class="text-blue">Scan Report</h2>
          <table id="tblScanResultAgentPool" class="table table-borderless table-sm">
            <thead style="border-bottom:solid; border-width: 1px;">
              <tr>
                <th width="30%">Description</th>
                <th width="20%">Severity</th>
                <th width="20%">Resource Name</th>
                <th width="20%">Status</th>
                <th width="10%">Resource</th>
              </tr>
            </thead class="table table-borderless">
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
    </div>
   </div>
    <!-- To change the direction of the modal animation change .right class -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  
    <!-- Add class .modal-side and then add class .modal-top-right (or other classes from list above) to set a position to the modal -->
    <div class="modal-dialog modal-lg modal-side modal-top-right" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title w-100" id="myModalLabel">Control Failure Details for <span id="spnFailedControl">
            </span></h2>
        </div>
        <div class="modal-body" style="overflow:scroll;max-height:350px;width:100%;overflow:auto">
          <table id="tblControlFailDetails" class="table table-borderless table-sm">
            <thead style="border-bottom:solid; border-width: 1px;">
              <tr>
                <th width="25%">Project Name</th>
                <th width="25%"><span id="spnScanType"> </span> Resource Name</th>
                <th width="25%">Created By</th>
              </tr>
            </thead>
            <tbody class="table table-borderless">
            </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal" style="height:38px;">
            Close</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Side Modal Top Right -->

  </div>
</body>
<script src="https://code.highcharts.com/highcharts.js"></script>

</html>