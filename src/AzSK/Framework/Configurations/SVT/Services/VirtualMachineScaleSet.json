{
   "FeatureName": "VirtualMachineScaleSet",
   "Reference": "aka.ms/azsktcp/virtualmachinescaleset",
   "IsMaintenanceMode": false,
    "Controls": [
       {
          "ControlID": "Azure_VirtualMachineScaleSet_Deploy_Monitoring_Agent",
          "Description": "Virtual Machine Scale Set should have latest OS version installed",
          "Id": "VirtualMachineScaleSet110",
          "ControlSeverity": "Medium",
          "Automated": "Yes",
          "MethodName": "CheckVMSSMonitoringAgent",
          "Rationale": "Being on the latest OS version significantly reduces risks from security design issues and security bugs that may be present in older versions.",
          "Recommendation": "Run command 'Update-AzVM -ResourceGroupName {resourceGroupName} -VM (Get-AzVM -ResourceGroupName {resourceGroupName} -Name {vmName})' . Run 'Get-Help Update-AzVM -full' for more help.",
          "Tags": [
             "SDL",
             "TCP",
             "Automated",
             "Deploy",
             "Windows",
             "Linux",
             "ERvNet",
             "VirtualMachineScaleSet"
          ],
          "Enabled": true
       },
       {
         "ControlID": "Azure_VirtualMachineScaleSet_SI_Enable_Antimalware",
         "Description": "Antimalware must be enabled with real time protection on Virtual Machine Scale Set",
         "Id": "VirtualMachineScaleSet120",
         "ControlSeverity": "High",
         "Automated": "Yes",
         "MethodName": "CheckVMSSAntimalwareStatus",
         "Rationale": "Enabling antimalware protection minimizes the risks from existing and new attacks from various types of malware. Microsoft Antimalware provide real-time protection, scheduled scanning, malware remediation, signature updates, engine updates, samples reporting, exclusion event collection etc.",
         "Recommendation": "To install antimalware, Go to Azure Portal --> VM Properties --> Extensions --> Add 'Microsoft Antimalware' --> Enable Real-Time Protection and Scheduled Scan --> Click Ok. If antimalware is already present on VM, validate and resolve endpoint protection recommendations in ASC.",
         "Tags": [
            "SDL",
            "TCP",
            "Automated",
            "Config",
            "Windows",
            "SI",
            "ERvNet",
            "VirtualMachineScaleSet"
         ],
         "Enabled": true
      },
      {
         "ControlID": "Azure_VirtualMachineScaleSet_Audit_Enable_Diagnostics",
         "Description": "Diagnostics (IaaSDiagnostics extension on Windows; LinuxDiagnostic extension on Linux) must be enabled on Virtual Machine",
         "Id": "VirtualMachineScaleSet130",
         "ControlSeverity": "Medium",
         "Automated": "Yes",
         "MethodName": "CheckVMSSDiagnostics",
         "Rationale": "Diagnostics logs are needed for creating activity trail while investigating an incident or a compromise.",
         "Recommendation": "Go to Azure Portal --> VM Properties --> Diagnostics settings --> Enable guest-level-monitoring. Refer: https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/azure-diagnostics",
         "Tags": [
            "SDL",
            "TCP",
            "Automated",
            "Audit",
            "Windows",
            "Linux",
            "ERvNet",
            "VirtualMachineScaleSet"
         ],
         "Enabled": true
      },
      {
         "ControlID": "Azure_VirtualMachineScaleSet_Deploy_ApplicationHealth_Agent",
         "Description": "Virtual Machine Scale Set should have latest OS version installed",
         "Id": "VirtualMachineScaleSet140",
         "ControlSeverity": "Medium",
         "Automated": "Yes",
         "MethodName": "CheckVMSSMonitoringAgent",
         "Rationale": "Being on the latest OS version significantly reduces risks from security design issues and security bugs that may be present in older versions.",
         "Recommendation": "Run command 'Update-AzVM -ResourceGroupName {resourceGroupName} -VM (Get-AzVM -ResourceGroupName {resourceGroupName} -Name {vmName})' . Run 'Get-Help Update-AzVM -full' for more help.",
         "Tags": [
            "SDL",
            "TCP",
            "Automated",
            "Deploy",
            "Windows",
            "Linux",
            "ERvNet",
            "VirtualMachineScaleSet"
         ],
         "Enabled": true
      },
      {
         "ControlID": "Azure_VirtualMachineScaleSet_DP_Enable_Disk_Encryption",
         "Description": "Disk encryption must be enabled on both OS and data disks for Windows Virtual Machine Scale Set",
         "Id": "VirtualMachineScaleSet150",
         "ControlSeverity": "High",
         "Automated": "Yes",
         "MethodName": "CheckVMSSDiskEncryption",
         "Rationale": "Using this feature ensures that sensitive data is stored encrypted at rest. This minimizes the risk of data loss from physical theft and also helps meet regulatory compliance requirements. In the case of VMs, both OS and data disks may contain sensitive information that needs to be protected at rest. Hence disk encryption must be enabled for both.",
         "Recommendation": "Refer: https://docs.microsoft.com/en-us/azure/security-center/security-center-disk-encryption?toc=%2fazure%2fsecurity%2ftoc.json. Note: After enabling disk encryption, it takes some time for changes to reflect in Azure Security Center (ASC). Thus, if you scan immediately, the control may still fail even though the VM itself shows as encrypted. Please wait a few hours to ascertain the fix.",
         "Tags": [
            "SDL",
            "TCP",
            "Automated",
            "DP",
            "Windows",
            "ERvNet",
            "VirtualMachineScaleSet"
         ],
         "Enabled": true
      },
      {
         "ControlID": "Azure_VirtualMachineScaleSet_SI_Latest_Model_Applied",
         "Description": "Disk encryption must be enabled on both OS and data disks for Windows Virtual Machine Scale Set",
         "Id": "VirtualMachineScaleSet160",
         "ControlSeverity": "High",
         "Automated": "Yes",
         "MethodName": "CheckVMSSInstancesStatus",
         "Rationale": "Using this feature ensures that sensitive data is stored encrypted at rest. This minimizes the risk of data loss from physical theft and also helps meet regulatory compliance requirements. In the case of VMs, both OS and data disks may contain sensitive information that needs to be protected at rest. Hence disk encryption must be enabled for both.",
         "Recommendation": "Refer: https://docs.microsoft.com/en-us/azure/security-center/security-center-disk-encryption?toc=%2fazure%2fsecurity%2ftoc.json. Note: After enabling disk encryption, it takes some time for changes to reflect in Azure Security Center (ASC). Thus, if you scan immediately, the control may still fail even though the VM itself shows as encrypted. Please wait a few hours to ascertain the fix.",
         "Tags": [
            "SDL",
            "TCP",
            "Automated",
            "SI",
            "Linux",
            "Windows",
            "ERvNet",
            "VirtualMachineScaleSet"
         ],
         "Enabled": true
      },
      {
         "ControlID": "Azure_VirtualMachineScaleSet_AuthZ_Grant_Min_RBAC_Access",
         "Description": "All users/identities must be granted minimum required permissions using Role Based Access Control (RBAC)",
         "Id": "VirtualMachineScaleSet170",
         "ControlSeverity": "Medium",
         "Automated": "Yes",
         "MethodName": "CheckRBACAccess",
         "Rationale": "Granting minimum access by leveraging RBAC feature ensures that users are granted just enough permissions to perform their tasks. This minimizes exposure of the resources in case of user/service account compromise.",
         "Recommendation": "Remove any excessive privileges granted on the Virtual Machine Scale Set. Run command: Remove-AzRoleAssignment -SignInName '<SignInName>' -Scope '<Scope>' RoleDefinitionName '<RoleDefinitionName>'. Run 'Get-Help Remove-AzRoleAssignment -full' for more help.",
         "Tags": [
           "SDL",
           "TCP",
           "Automated",
           "AuthZ",
           "RBAC",
           "VirtualMachineScaleSet"
         ],
         "Enabled": true
      }
    ]
 }
 